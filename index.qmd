---
format:
  revealjs:
    transition: fade
    theme: night
    mermaid-format: svg
from: markdown+emoji
---

#  {background-image="images/julia-joppien-XFUqd0u5U7w-unsplash.jpg"}

::: notes
I'm David Aja, a member of the SE team at RStudio.  
I help data scientists get their ideas into production.  
I see a lot of broken things.  
So that's why today I'll be talking about:
:::

#  {background-image="images/julia-joppien-XFUqd0u5U7w-unsplash.jpg"}

::: columns
::: {.column width="30%"}
::: {.r-fit-text color="white"}
You <br/> should <br/> use <br/> renv.
:::
:::

::: {.column width="70%"}
:::
:::

::: fragment
(probably.)
:::

# agenda

::: columns

::: {.column width="50%"}
::: {.r-fit-text .fragment}
why
:::
:::


::: {.column width="50%"}
::: {.r-fit-text .fragment}
how
:::
:::

:::

# why

## we have a standards problem

::: fragment
what makes a project an *R* project?
:::

## what is a project?

::: {.fragment .fade-in}
> *an individual or collaborative enterprise that is carefully planned to achieve a particular aim.*
>
> -- Oxford Languages
:::

::: notes
- functional definition: a thing is what it does
:::

## what is a project?

::: r-stack
::: {.fragment .fade-in .r-fit-text }
a project *ships*.
:::

::: {.fragment }
![](images/AOL_promotional_CDs_in_Canada.jpeg)
:::

:::

## I thought this guy works at RStudio

## ceci n'est pas un projet

::: r-fit-text
\*.Rproj
:::

## `*.Rproj`

    Version: 1.0

    RestoreWorkspace: Default
    SaveWorkspace: Default
    AlwaysSaveHistory: Default

    UseSpacesForTab: Yes
    NumSpacesForTab: 2
    Encoding: UTF-8

    AutoAppendNewline: Yes
    StripTrailingWhitespace: Yes

::: fragment
You don't ship your editor.
:::

::: {.fragment .smaller style="text-align: right;"}
:see_no_evil: I have shipped my editor.
:::

<br/>
<br/>

::: notes
-   `.Rproj` is mostly editor config
-   signifier but doesn't accomplish proejct goals
-   Some RStudio handling of configurable R behaviors, but R doesn't know that
-   I didn't get here from a history of flawless decision making.
:::

## `*.Rproj`

**necessary**, but not sufficient

# what *is* a project?

::: notes
-   we're increasing the diversity of things R can do and where it does them
-   behooves us to learn from other language and framework paradigms and how they think about reliably delivering product
-   12 factor is focused on deploying web applications but many lessons translate
:::

## 12 factor

> A twelve-factor app **never** relies on implicit existence of system-wide packages.

::: columns
::: {.column .fragment width="49%"}
It declares all dependencies, completely and exactly, via a dependency declaration manifest.
:::

::: {.column .fragment width="49%" style="text-align: right;"}
It uses a dependency isolation tool \[...\] to ensure that no implicit dependencies "leak in"
:::

:::

## leak-in

```{mermaid}
%%{init: {"theme": "dark" } }%%
graph
L --- P1
L(user library)
P1(dashboard <br/> dplyr 1.0.5)
```

## leak-in

```{mermaid}
%%{init: {"theme": "dark" } }%%
graph
L --- P1
L --- P2
L(library)
P1(dashboard <br/> dplyr 0.8.5)
P2("windowed daily census tract stats <br/> &#129300;")
```

## 

### `install_github("tidyverse/dtplyr")` {.smaller}

```{mermaid}
%%{init: {"theme": "dark" } }%%
graph
L --- P1
L --- P2
L(library)
P1(dashboard <br/> dplyr 0.8.5)
P2("windowed daily census tract stats <br/> tidyverse/dtplyr@main")
```

## 

### `install_github("tidyverse/dtplyr")` {.smaller}

```{mermaid}
%%{init: {"theme": "dark" } }%%
graph
L --- P1
L --- P2
L(library)
P1("dashboard <br/> <span style='color:red'>dplyr 1.0.5</span>")
P2("windowed daily census tract stats <br/> tidyverse/dtplyr@main")
```

## panic, a haiku

when do you think you <br/> want to  discover that you've <br/> broken your dashboard?

# how

## 

::: r-fit-text
isolate.
:::

## `renv::init()`
or, 

![](images/paste-547A1832.png)

## `renv::init()`

```{mermaid}
%%{init: {"theme": "dark" } }%%
graph
L --- P1
L2 --- P2
L(library)
L2(Library)
P1(dashboard <br/> dplyr 0.8.5)
P2("windowed daily census tract stats <br/> tidyverse/dtplyr@main <br/> dplyr 1.0.5")
```

## `renv::init()`

```{mermaid}
%%{init: {"theme": "dark" } }%%
graph
L --- P1
L2 --- P2
L3 --- P3
L(library)
L2(Library)
L3(Library)
P1(dashboard <br/> dplyr 0.8.5)
P2("windowed daily census tract stats <br/> tidyverse/dtplyr@main <br/> dplyr 1.0.5")
P3("hierarchical model experiments <br/> ")
```

## cache, money

```{mermaid}
%%{init: {"theme": "dark" } }%%
graph
L --- P1
L2 --- P2
L3 --- P3
C --- L2
C --- L3
L(library)
L2(Library)
L3(Library)
P1(dashboard <br/> dplyr 0.8.5)
P2("windowed daily census tract stats <br/> tidyverse/dtplyr@main <br/> dplyr 1.0.5")
P3("hierarchical model experiments <br/> ")
C(renv package cache)
```

## 

::: r-fit-text
enumerate.
:::


## `renv::snapshot()`

`renv.lock`

``` json
{
  ...
  "Packages": {
    "DBI": {
      "Package": "DBI",
      "Version": "1.1.1",
      "Source": "Repository",
      "Repository": "CRAN",
      "Hash": "030aaec5bc6553f35347cbb1e70b1a17"
    },
    ...
  }
}
```

## 

::: r-fit-text
collaborate.
:::

## `renv::status()`

```{.r}
The following package(s) are recorded in the lockfile but not installed:
              _
  R6            [2.5.0]
  Rcpp          [1.0.6]
  askpass       [1.1]
  base64enc     [0.1-3]
  bslib         [0.2.4]
  ...
  sourcetools   [0.1.7]
  sys           [3.4]
  withr         [2.4.0]
  xtable        [1.8-4]
  yaml          [2.2.1]

Use `renv::restore()` to install these packages.
```

## 

`renv.lock`
```
  "R": {
    "Version": "4.1.1",
    "Repositories": [
      {
        "Name": "CRAN",
        "URL": "https://cran.rstudio.com"
      }
    ]
  },
```

## `renv::restore()`



# other patterns

## the junk drawer

::: r-fit-text
`~/Documents/scratch`
:::

## `renv::use()`

# probably?

## I don't intend to re-use this code



## I'm purely a package developer

https://rstudio.github.io/renv/articles/packages.html#isolation



![](https://imgs.xkcd.com/comics/standards.png)

# we have an opportunity

Let's coalesce on a project standard.
Use renv.

## feedback:

Kevin:
make sure you call out that projects need lockfiles
what's happening with respect to the private package library
discuss when to call snapshot

Alex:
reverse the motivation so that it's less of an appeal to authority
people need to be shown that it's not that hard

who is this for?
showcase horrors?
mention cache?
https://groundhogr.com/renv/
